import { ipcRenderer } from 'electron'

import ExecutionService from './../ExecutionService'
import ConfigManager from './../ConfigManager'

let configManager = new ConfigManager()
let executionService = new ExecutionService()

export default class WebUrl {
    constructor() {
        this.icon = `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1">
                        <g id="surface1">
                            <path style=" " d="M 16 4 C 9.382813 4 4 9.382813 4 16 C 4 22.617188 9.382813 28 16 28 C 22.617188 28 28 22.617188 28 16 C 28 9.382813 22.617188 4 16 4 Z M 16 6 C 16.179688 6 16.453125 6.109375 16.8125 6.53125 C 17.171875 6.953125 17.539063 7.644531 17.875 8.5625 C 18.03125 8.992188 18.183594 9.484375 18.3125 10 L 13.6875 10 C 13.816406 9.484375 13.96875 8.992188 14.125 8.5625 C 14.460938 7.644531 14.828125 6.953125 15.1875 6.53125 C 15.546875 6.109375 15.820313 6 16 6 Z M 12.8125 6.5 C 12.589844 6.917969 12.398438 7.378906 12.21875 7.875 C 11.984375 8.519531 11.796875 9.238281 11.625 10 L 8 10 C 9.203125 8.394531 10.871094 7.152344 12.8125 6.5 Z M 19.1875 6.5 C 21.128906 7.152344 22.796875 8.394531 24 10 L 20.375 10 C 20.203125 9.238281 20.015625 8.519531 19.78125 7.875 C 19.601563 7.378906 19.410156 6.917969 19.1875 6.5 Z M 6.8125 12 L 11.28125 12 C 11.152344 12.949219 11.0625 13.957031 11.03125 15 L 6.0625 15 C 6.164063 13.945313 6.410156 12.933594 6.8125 12 Z M 13.3125 12 L 18.6875 12 C 18.828125 12.9375 18.929688 13.945313 18.96875 15 L 13.03125 15 C 13.070313 13.945313 13.171875 12.9375 13.3125 12 Z M 20.71875 12 L 25.1875 12 C 25.589844 12.933594 25.835938 13.945313 25.9375 15 L 20.96875 15 C 20.9375 13.957031 20.847656 12.949219 20.71875 12 Z M 6.0625 17 L 11.03125 17 C 11.0625 18.042969 11.152344 19.050781 11.28125 20 L 6.8125 20 C 6.410156 19.066406 6.164063 18.054688 6.0625 17 Z M 13.03125 17 L 18.96875 17 C 18.929688 18.054688 18.828125 19.0625 18.6875 20 L 13.3125 20 C 13.171875 19.0625 13.070313 18.054688 13.03125 17 Z M 20.96875 17 L 25.9375 17 C 25.835938 18.054688 25.589844 19.066406 25.1875 20 L 20.71875 20 C 20.847656 19.050781 20.9375 18.042969 20.96875 17 Z M 8 22 L 11.625 22 C 11.796875 22.761719 11.984375 23.480469 12.21875 24.125 C 12.398438 24.621094 12.589844 25.082031 12.8125 25.5 C 10.871094 24.847656 9.203125 23.605469 8 22 Z M 13.6875 22 L 18.3125 22 C 18.183594 22.515625 18.03125 23.007813 17.875 23.4375 C 17.539063 24.355469 17.171875 25.046875 16.8125 25.46875 C 16.453125 25.890625 16.179688 26 16 26 C 15.820313 26 15.546875 25.890625 15.1875 25.46875 C 14.828125 25.046875 14.460938 24.355469 14.125 23.4375 C 13.96875 23.007813 13.816406 22.515625 13.6875 22 Z M 20.375 22 L 24 22 C 22.796875 23.605469 21.128906 24.847656 19.1875 25.5 C 19.410156 25.082031 19.601563 24.621094 19.78125 24.125 C 20.015625 23.480469 20.203125 22.761719 20.375 22 Z "></path>
                        </g>
                    </svg>`

        this.name = 'Web URL'
    }

    getName() {
        return this.name
    }

    isValid(url) {
        let expression = /^((https?:)?[/]{2})?([a-z0-9]+[.])+[a-z]+.*$/i
        let regex = new RegExp(expression)

        if (url.match(regex))
            return true

        return false
    }

    execute(url) {
        url = addHttpToUrl(url)
        executionService.openDefaultBrowser(url)
        ipcRenderer.send('hide-main-window')
    }

    getSearchResult(userInput) {
        return [{
            name: `Open in browser`,
            execArg: addHttpToUrl(userInput),
            icon: this.icon
        }]
    }
}

function addHttpToUrl(url) {
    if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('//'))
        url = `http://${url}`

    return url
}